{% extends "BFSiteBundle::base.html.twig" %}


{% block meta %}
	<meta name="description" content="Bla bla bla concernant le profil.">
	<meta name="keywords" content="soccer,football, ">
{% endblock %}


{% block title %}
  Profile of {{ user.username }}- {{ parent() }} sur BestFootball.com 
{% endblock %}

{% block content %}
  <input type="hidden" name="user" id="user" value="{{ user.id }}">
<section class="profile">
        <div class="row">
          <div class="col-xs-10 col-sm-10 col-md-10 col-lg-10 col-xs-offset-1 col-sm-offset-1 col-md-offset-1 col-lg-offset-1">
            <!-- The top section of the profile page -->
            <div class="profiletop">
              <div class="col-xs-2 col-sm-3 col-md-3 col-lg-3 vcenter row text-center">
                <img src="/uploads/img/{{ user.picture.src }}" alt="{{ user.picture.alt }}" style="width:100%;"/>
              </div><!--
              --><div class="col-xs-8 col-sm-6 col-md-6 col-lg-6 vcenter">
                <h1 class="text-center">{{user.username}}</h1>
                <p>{{ age }} Years</br>{{ user.city }}, {{ user.country.name }}</br>{{ user.footballClub }}</br>{{ user.foot }} foot</br>Position: {{ user.fieldPosition }}</p>
              </div><!--
              --><div class="col-xs-2 col-sm-3 col-md-3 col-lg-3 vcenter">
                <h2 class="text-center">{{ rankinfo.level }}</h2>
                <div class="progress class="text-center"">
                  <div class="progress-bar {{ rankinfo.style }} progress-bar-striped active" role="progressbar" aria-valuenow="{{ user.points }}" aria-valuemin="{{ rankinfo.min}}" aria-valuemax="{{ rankinfo.max}}" style="width:{{ rankinfo.percent}}%;">
                    {{ user.points }} Points
                  </div>
                </div>
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 row">
                  <h3 class="text-center">Ranking</h3>
                  <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                    <img src="/img/globe.png" alt="globe ranking" style="width:25px;"/><!--globe -->
                  </div><!--
                  --><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                    <p> {{ rankinfo.globalrank }}</p>
                  </div>
                    {% if user.country.name == 'France' %}
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row"><!--country -->
                        <img src="/img/fr.jpg" alt="" style="width:25px;"/>
                      </div><!--
                   --><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                        <p> {{ rankinfo.countryrank }} </p>
                      </div>
                    {% elseif user.country.name == 'United States' %}
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row"><!--country -->
                        <img src="/img/usa.jpg" alt="" style="width:25px;"/>
                      </div><!--
                   --><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                        <p> {{ rankinfo.countryrank }} </p>
                      </div>
                    {% elseif user.country.name == 'Belgium' %}
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row"><!--country -->
                        <img src="/img/be.jpg" alt="" style="width:25px;"/>
                      </div><!--
                    --><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                        <p> {{ rankinfo.countryrank }} </p>
                      </div>
                    {% else %}
                    {% endif %}
                    {% if user.state is not null %}
                      <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                        <p>{{ user.state.name }} <!--State -->
                      </div><!--
                   --><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 row">
                        <p> {{ rankinfo.staterank }} </p>
                      </div>
                   
                    {% else %}
              
                    {% endif %}
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 row text-center">
                    <h3>Duel Ranking</h3>
                    {% if duelrankinfo.level == 1 %}
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                    {% elseif duelrankinfo.level == 2 %}
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                    {% elseif duelrankinfo.level == 3 %}
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                    {% elseif duelrankinfo.level == 4 %}
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                      <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 row">
                        <img src="/img/duelrank.jpg" alt="duel ranking indicator on bestfootball" style="width:100%"/>
                      </div>
                    {% endif %}
                    {{ duelrankinfo.level }}
                  </div>
                </div>

                 {% if lists.listFollows|length > 0 %}
                      {% set followers = 0 %}
                      {% for follow in lists.listFollows %}
                       {% set followers = followers + 1 %}
                      {% endfor %}

                      Followers : {{ followers }}</br>
                    {% endif %}

                {% if user.username != app.user.username %}
                  <a href="{{ path('bf_site_duel_create', {'username': user.username }) }}" class="btn btn-success">
                    <i class="glyphicon glyphicon-ok"></i>
                       Duel me !
                  </a>

                  <a id="follow" value="{{ user.id }}" class="btn btn-success">
                    <i class="glyphicon glyphicon-ok"></i>
                       Follow me !
                  </a>

                  <a id="unfollow" value="{{ user.id }}" class="btn btn-success">
                    <i class="glyphicon glyphicon-ok"></i>
                       Followed !
                  </a>

                {% endif %}

              </div>
            </div>
            <!-- The last video section of thez profile-->
          {% if lists.listVideos|length > 0 %}
            <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8 vcenter">
              {% if lastVideo|length > 0 %}
                <video width="100%" id="video" controls>
                  <source src="/uploads/videos/{{lastVideo.id}}.{{ lastVideo.source }}" type="video/mp4">
                Your browser does not support the video tag.
                </video>
              {% endif %}
            </div><!--
         --><div class="col-xs-12 col-sm-12 col-md-4 col-lg-4 vcenter"> 
                <div class="videotabback">
                  <div class="challengetitle text-center">
                    <h3 style="color:white;">My videos </h3>
                  </div>
                  <div class="challengecontent">
                    <ul class="playlist" style="list-style-type:none;padding-left:0px;" >
                      {% for video in lists.listVideos %}
                        <li>
                          <a href="/uploads/videos/{{ video.id }}.mp4">
                            <div class="videotab row">
                              <div class="col-xs-5 col-sm-5 col-md-4 col-lg-4 vcenter row">
                                <img src="/uploads/videos/thumbnail/{{ video.id }}.jpg" alt="" style="width:100%;"/>
                              </div><!--
                           --><div class="col-xs-7 col-sm-7 col-md-8 col-lg-8 vcenter">
                                <p style="font-size:14px;">{{ video.title }},</br> {{ video.date|date('d-m-Y')}}</p>
                                <a href="{{ path('bf_site_video_report', {'id': video.id}) }}">report this video</a>
                              </div>
                            </div>
                          </a>
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                </div>
            </div>
          {% endif %}
            <!-- The challenges section of thez profile-->
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 vcenter row">
                <div class="challengedescription">
                  <div class="challengetitle">
                    <h3 class="text-center" style="color:white;">My Challenges</h3>
                  </div>
                  <div class="challengecontent">
                    
                    {% if lists.listChallenges|length > 0 %}
                      <ul class="playlist" style="list-style-type:none;padding-left:0px;" >
                      {% for challenge in lists.listChallenges %}
                        
                      <li>
                        <a href="/uploads/videos/{{ challenge.id }}.mp4">
                          <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 container text-center row" style="background-color:rgba(0,0,0,0.7)">
                            <h4>{{ challenge.challenge.title }}</h4>
                            <img src="/uploads/videos/thumbnail/{{ challenge.id}}.jpg" alt="{{ challenge.thumbAlt }}" class="img-responsive"></a>
                              {# calculating the rank off the user #}
                              {% if challenge.repetitions > challenge.challenge.six %}
                                 <h5>Legend</h5>
                              {% elseif challenge.repetitions == challenge.challenge.six %}
                                <h5>Expert</h5>
                              {% else %}
                                <h5>Points : {{ challenge.score }}</h5>
                              {% endif %}
                              <a href="{{ path('bf_site_video_report', {'id': challenge.id}) }}">report this video</a>
                          </div>
                        </a>
                      </li>
                      {% endfor %}
                    </ul>
                    {% else %}
                    <p> This user didn't participate at any challenges</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            <!-- The challenges section of thez profile-->
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 vcenter row">
                <div class="challengedescription">
                  <div class="challengetitle">
                    <h3 class="text-center" style="color:white;">My Duels</h3>
                  </div>
                  <div class="challengecontent">
                    
                    {% if lists.listDuels|length > 0 %}
                      {% for duel in lists.listDuels %}
                        <a href="{{ path('bf_site_duel_view', {'id': duel.id }) }}">
                          <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 container text-center" style="margin:5px;border-radius: 15px 50px;height:250px;">
                          <h4 style>{{ duel.challenge.title }}</h4>
                          <img src="/uploads/challenges/thumbnail/{{ duel.challenge.id}}.jpg" alt="{{ duel.challenge.imageAlt }}" class="img-responsive"></a>
                          <p>
                          {% if duel.completed == 1 %}
                            {% if duel.winner is not null %}
                              {% if duel.winner == user.username %}
                                WON
                              {% else %}
                                LOST
                              {% endif %}
                            {% else %}
                              Draw !
                            {% endif %}
                          {% else %}
                            In progress !
                          {% endif %}
                          </p>
                        </div>
                        </a>
                      {% endfor %}
                    {% else %}
                    <p> This user didn't participate at any challenges</p>
                    {% endif %}
                  </div>
                </div>
              </div>
          </div>
        </div>
      </section>
{% endblock %}


{% block javascripts %}
  <script>
      var video;
      var playlist;
      var tracks;
      var current;

      init();
      function init(){
          current = 0;
          video = $('#video');
          playlist = $('.playlist');
          tracks = playlist.find('li a');
          len = tracks.length - 1;
          video[0].volume = .90;
          //video[0].play();
          playlist.find('a').click(function(e){
              e.preventDefault();
              link = $(this);
              current = link.parent().index();
              run(link, video[0]);
          });
          video[0].addEventListener('ended',function(e){
              current++;
              if(current == len){
                  current = 0;
                  link = playlist.find('a')[0];
              }else{
                  link = playlists..find('a')[current];    
              }
              run($(link),video[0]);
          });
      }
      function run(link, player){
              player.src = link.attr('href');
              par = link.parent();
              par.addClass('active').siblings().removeClass('active');
              video[0].load();
              video[0].play();
      }
    </script>

{% if follow is not null %}
  {% if follow == 0 %}
  <script>
    $("#unfollow").hide();
    $("#follow").click(function(){ 
        var id = $("#user").val();
        var DATA = 'id=' + id;
        $.ajax({
            type: "POST",
            url: "{{ path('bf_site_follow')}}",
            data: DATA,
            cache: false,
            success: function(){
               $('#unfollow').show();
               $("#follow").hide();
               $("#unfollow").click(function(){ 
                var id = $("#user").val();
                var DATA = 'id=' + id;
                $.ajax({
                    type: "POST",
                    url: "{{ path('bf_site_unfollow')}}",
                    data: DATA,
                    cache: false,
                    success: function(){
                       $('#follow').show();
                       $("#unfollow").hide();
                    }
                });    
                return false;
            });
            }
        });    
        return false;
    });
  </script>
  {% elseif follow == 1 %}
  <script>
    $("#follow").hide();
    $("#unfollow").click(function(){ 
        var id = $("#user").val();
        var DATA = 'id=' + id;
        $.ajax({
            type: "POST",
            url: "{{ path('bf_site_unfollow')}}",
            data: DATA,
            cache: false,
            success: function(){
               $('#follow').show();
               $("#unfollow").hide();
               $("#follow").click(function(){ 
                var id = $("#user").val();
                var DATA = 'id=' + id;
                $.ajax({
                    type: "POST",
                    url: "{{ path('bf_site_follow')}}",
                    data: DATA,
                    cache: false,
                    success: function(){
                       $('#unfollow').show();
                       $("#follow").hide();
                    }
                });    
                return false;
            });
            }
        });    
        return false;
    });
  </script>
  {% endif %}
{% endif %}

{% endblock %}
